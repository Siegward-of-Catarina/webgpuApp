(()=>{"use strict";class t{constructor(t,e){const i=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,n={size:e.byteLength,usage:i,mappedAtCreation:!0};this.buffer=t.createBuffer(n),new Uint32Array(this.buffer.getMappedRange()).set(e),this.buffer.unmap()}}class e{constructor(t,e){const i=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,n={size:e.byteLength,usage:i,mappedAtCreation:!0};this.buffer=t.createBuffer(n),new Float32Array(this.buffer.getMappedRange()).set(e),this.buffer.unmap()}}const i=t=>{if(null===t)throw Error(t+"is null");console.log("success")};class n{constructor(){this._vertexBuffer=null,this._indexBuffer=null,this._indexCount=null,this._indexFormat="uint32"}get vertexBuffer(){return i(this._vertexBuffer),this._vertexBuffer.buffer}get indexBuffer(){return i(this._indexBuffer),this._indexBuffer.buffer}get indexCount(){return i(this._indexCount),this._indexCount}get indexFormat(){return this._indexFormat}}class r extends n{constructor(i){super();const n=new Float32Array([-.5,.5,0,1,0,0,-.5,-.5,0,0,1,0,.5,.5,0,0,0,1,.5,-.5,0,1,0,0]);this._vertexBuffer=new e(i,n);const r=new Uint32Array([0,1,2,2,1,3]);this._indexCount=r.length,this._indexBuffer=new t(i,r)}}class s{constructor(){this._module=null,this._bufferLayout=null,this._entryPoint={Vertex:"vs_main",Fragment:"fs_main"}}get module(){return i(this._module),this._module}get bufferLayout(){return i(this._bufferLayout),this._bufferLayout}get entryPoint(){return this._entryPoint}}class o extends s{constructor(t){super(),this._module=t.createShaderModule({code:"struct TransformData{\r\n  model: mat4x4<f32>,\r\n  view: mat4x4<f32>,\r\n  projection: mat4x4<f32>\r\n};\r\n@binding(0) @group(0) var <uniform> transformUBO : TransformData;\r\n\r\nstruct Output {\r\n    @builtin(position) Position : vec4<f32>,\r\n    @location(0) Color : vec4<f32>\r\n};\r\n\r\n@vertex\r\nfn vs_main(@location(0) vertexPosition: vec3<f32>, @location(1) vertexColor: vec3<f32> ) -> Output {\r\n\r\n\r\n\r\n    var output : Output;\r\n    var mvpMat = transformUBO.projection * transformUBO.view * transformUBO.model;\r\n    output.Position = mvpMat * vec4<f32>(vertexPosition, 1.0);\r\n    output.Color = vec4<f32>(vertexColor, 1.0);\r\n\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fs_main(@location(0) Color: vec4<f32>) -> @location(0) vec4<f32> {\r\n    return Color;\r\n}"}),this._bufferLayout={arrayStride:24,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12}]}}}var a=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array;function h(){var t=new u(16);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});class f{constructor(){this.texture=null,this.view=null,this.sampler=null}initialize(t,e){return i=this,n=void 0,s=function*(){const t=yield fetch(e),i=yield t.blob();yield createImageBitmap(i)},new((r=void 0)||(r=Promise))((function(t,e){function o(t){try{u(s.next(t))}catch(t){e(t)}}function a(t){try{u(s.throw(t))}catch(t){e(t)}}function u(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(o,a)}u((s=s.apply(i,n||[])).next())}));var i,n,r,s}}var c,l,d=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{u(n.next(t))}catch(t){s(t)}}function a(t){try{u(n.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((n=n.apply(t,e||[])).next())}))};class v{constructor(t){this.Initialize=()=>d(this,void 0,void 0,(function*(){yield this.setupDevice(),yield this.createAssets(),yield this.makePipeline(),this.render()})),this.setupDevice=()=>d(this,void 0,void 0,(function*(){var t;this.adapter=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter(),i(this.adapter),this.device=yield this.adapter.requestDevice(),i(this.device),this.context=this.canvas.getContext("webgpu"),i(this.context),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})})),this.createAssets=()=>d(this,void 0,void 0,(function*(){this.mesh=new r(this.device),this.material=new f,yield this.material.initialize(this.device,"dist/img/sacabambaspis.png"),this.shader=new o(this.device)})),this.makePipeline=()=>d(this,void 0,void 0,(function*(){this.uniformBuffer=this.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]});this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]}),i(this.bindGroup);const e=this.device.createPipelineLayout({bindGroupLayouts:[t]});this.pipeline=this.device.createRenderPipeline({vertex:{module:this.shader.module,entryPoint:this.shader.entryPoint.Vertex,buffers:[this.shader.bufferLayout]},fragment:{module:this.shader.module,entryPoint:this.shader.entryPoint.Fragment,targets:[{format:this.format}]},primitive:{topology:"triangle-list"},layout:e}),i(this.pipeline)})),this.render=()=>{const t=h();!function(t,e,i,n,r){var s,o=1/Math.tan(e/2);t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(s=1/(n-r),t[10]=(r+n)*s,t[14]=2*r*n*s):(t[10]=-1,t[14]=-2*n)}(t,Math.PI/4,this.canvas.width/this.canvas.height,.1,10);const e=h();var i,n,r,s,o,u,f,c,l,d,v,m,p,y,x,g,b,B,P,w,_,M,C;i=e,x=(n=[0,1,-2])[0],g=n[1],b=n[2],B=(s=[0,1,0])[0],P=s[1],w=s[2],_=(r=[0,0,0])[0],M=r[1],C=r[2],Math.abs(x-_)<a&&Math.abs(g-M)<a&&Math.abs(b-C)<a?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(i):(v=x-_,m=g-M,p=b-C,o=P*(p*=y=1/Math.hypot(v,m,p))-w*(m*=y),u=w*(v*=y)-B*p,f=B*m-P*v,(y=Math.hypot(o,u,f))?(o*=y=1/y,u*=y,f*=y):(o=0,u=0,f=0),c=m*f-p*u,l=p*o-v*f,d=v*u-m*o,(y=Math.hypot(c,l,d))?(c*=y=1/y,l*=y,d*=y):(c=0,l=0,d=0),i[0]=o,i[1]=c,i[2]=v,i[3]=0,i[4]=u,i[5]=l,i[6]=m,i[7]=0,i[8]=f,i[9]=d,i[10]=p,i[11]=0,i[12]=-(o*x+u*g+f*b),i[13]=-(c*x+l*g+d*b),i[14]=-(v*x+m*g+p*b),i[15]=1);const U=h();!function(t,e,i){var n,r,s,o,a,u,h,f,c,l,d,v,m=i[0],p=i[1],y=i[2];e===t?(t[12]=e[0]*m+e[4]*p+e[8]*y+e[12],t[13]=e[1]*m+e[5]*p+e[9]*y+e[13],t[14]=e[2]*m+e[6]*p+e[10]*y+e[14],t[15]=e[3]*m+e[7]*p+e[11]*y+e[15]):(n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],f=e[7],c=e[8],l=e[9],d=e[10],v=e[11],t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=h,t[7]=f,t[8]=c,t[9]=l,t[10]=d,t[11]=v,t[12]=n*m+a*p+c*y+e[12],t[13]=r*m+u*p+l*y+e[13],t[14]=s*m+h*p+d*y+e[14],t[15]=o*m+f*p+v*y+e[15])}(U,U,[Math.sin(this.time),0,0]),function(t,e,i,n){var r,s,o,u,h,f,c,l,d,v,m,p,y,x,g,b,B,P,w,_,M,C,U,A,G=n[0],F=n[1],L=n[2],O=Math.hypot(G,F,L);O<a||(G*=O=1/O,F*=O,L*=O,r=Math.sin(i),o=1-(s=Math.cos(i)),u=e[0],h=e[1],f=e[2],c=e[3],l=e[4],d=e[5],v=e[6],m=e[7],p=e[8],y=e[9],x=e[10],g=e[11],b=G*G*o+s,B=F*G*o+L*r,P=L*G*o-F*r,w=G*F*o-L*r,_=F*F*o+s,M=L*F*o+G*r,C=G*L*o+F*r,U=F*L*o-G*r,A=L*L*o+s,t[0]=u*b+l*B+p*P,t[1]=h*b+d*B+y*P,t[2]=f*b+v*B+x*P,t[3]=c*b+m*B+g*P,t[4]=u*w+l*_+p*M,t[5]=h*w+d*_+y*M,t[6]=f*w+v*_+x*M,t[7]=c*w+m*_+g*M,t[8]=u*C+l*U+p*A,t[9]=h*C+d*U+y*A,t[10]=f*C+v*U+x*A,t[11]=c*C+m*U+g*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(U,U,this.time,[0,1,0]),this.device.queue.writeBuffer(this.uniformBuffer,0,U),this.device.queue.writeBuffer(this.uniformBuffer,64,e),this.device.queue.writeBuffer(this.uniformBuffer,128,t);const A=this.device.createCommandEncoder(),G={colorAttachments:[{view:this.context.getCurrentTexture().createView(),clearValue:[.5,0,.25,1],loadOp:"clear",storeOp:"store"}]},F=A.beginRenderPass(G);F.setPipeline(this.pipeline),F.setBindGroup(0,this.bindGroup),F.setVertexBuffer(0,this.mesh.vertexBuffer),F.setIndexBuffer(this.mesh.indexBuffer,this.mesh.indexFormat),F.drawIndexed(this.mesh.indexCount),F.end(),this.device.queue.submit([A.finish()]),this.time+=.01,this.time>2*Math.PI&&(this.time-=2*Math.PI),requestAnimationFrame(this.render)},this.canvas=t,this.adapter=null,this.device=null,this.context=null,this.format=null,this.uniformBuffer=null,this.bindGroup=null,this.pipeline=null,this.mesh=null,this.material=null,this.shader=null,this.time=0}}l=function*(){const t=document.getElementById("gfx-main");new v(t).Initialize()},new((c=void 0)||(c=Promise))((function(t,e){function i(t){try{r(l.next(t))}catch(t){e(t)}}function n(t){try{r(l.throw(t))}catch(t){e(t)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof c?r:new c((function(t){t(r)}))).then(i,n)}r((l=l.apply(void 0,[])).next())}))})();