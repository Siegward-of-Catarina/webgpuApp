(()=>{"use strict";class t{constructor(t,e){const i=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,n={size:e.byteLength,usage:i,mappedAtCreation:!0};this.buffer=t.createBuffer(n),new Uint32Array(this.buffer.getMappedRange()).set(e),this.buffer.unmap()}}class e{constructor(t,e){const i=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,n={size:e.byteLength,usage:i,mappedAtCreation:!0};this.buffer=t.createBuffer(n),new Float32Array(this.buffer.getMappedRange()).set(e),this.buffer.unmap()}}const i=t=>{if(null===t)throw Error(t+"is null");console.log("success")};class n{constructor(){this._vertexBuffer=null,this._indexBuffer=null,this._indexCount=null,this._indexFormat="uint32"}get vertexBuffer(){return i(this._vertexBuffer),this._vertexBuffer.buffer}get indexBuffer(){return i(this._indexBuffer),this._indexBuffer.buffer}get indexCount(){return i(this._indexCount),this._indexCount}get indexFormat(){return this._indexFormat}}class r extends n{constructor(i){super();const n=new Float32Array([-.5,.5,0,1,0,0,-.5,-.5,0,0,1,0,.5,.5,0,0,0,1,.5,-.5,0,1,0,0]);this._vertexBuffer=new e(i,n);const r=new Uint32Array([0,1,2,2,1,3]);this._indexCount=r.length,this._indexBuffer=new t(i,r)}}class s{constructor(){this._module=null,this._bufferLayout=null,this._entryPoint={Vertex:"vs_main",Fragment:"fs_main"}}get module(){return i(this._module),this._module}get bufferLayout(){return i(this._bufferLayout),this._bufferLayout}get entryPoint(){return this._entryPoint}}class o extends s{constructor(t){super(),this._module=t.createShaderModule({code:"struct TransformData{\r\n  model: mat4x4<f32>,\r\n  view: mat4x4<f32>,\r\n  projection: mat4x4<f32>\r\n};\r\n@binding(0) @group(0) var <uniform> transformUBO : TransformData;\r\n\r\nstruct Output {\r\n    @builtin(position) Position : vec4<f32>,\r\n    @location(0) Color : vec4<f32>\r\n};\r\n\r\n@vertex\r\nfn vs_main(@location(0) vertexPosition: vec3<f32>, @location(1) vertexColor: vec3<f32> ) -> Output {\r\n\r\n\r\n\r\n    var output : Output;\r\n    var mvpMat = transformUBO.projection * transformUBO.view * transformUBO.model;\r\n    output.Position = mvpMat * vec4<f32>(vertexPosition, 1.0);\r\n    output.Color = vec4<f32>(vertexColor, 1.0);\r\n\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fs_main(@location(0) Color: vec4<f32>) -> @location(0) vec4<f32> {\r\n    return Color;\r\n}"}),this._bufferLayout={arrayStride:24,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12}]}}}var a=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array;function h(){var t=new u(16);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var f=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{u(n.next(t))}catch(t){s(t)}}function a(t){try{u(n.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((n=n.apply(t,e||[])).next())}))};class c{constructor(){this.initialize=(t,e)=>f(this,void 0,void 0,(function*(){const i=yield fetch(e),n=yield i.blob(),r=yield createImageBitmap(n);yield this.loadImageBitmap(t,r)})),this.loadImageBitmap=(t,e)=>f(this,void 0,void 0,(function*(){const i={size:{width:e.width,height:e.height},format:"bgra8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};this.texture=t.createTexture(i),t.queue.copyExternalImageToTexture({source:e},{texture:this.texture},i.size)})),this.texture=null,this.view=null,this.sampler=null}}var l,d,m=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{u(n.next(t))}catch(t){s(t)}}function a(t){try{u(n.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((n=n.apply(t,e||[])).next())}))};class v{constructor(t){this.Initialize=()=>m(this,void 0,void 0,(function*(){yield this.setupDevice(),yield this.createAssets(),yield this.makePipeline(),this.render()})),this.setupDevice=()=>m(this,void 0,void 0,(function*(){var t;this.adapter=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter(),i(this.adapter),this.device=yield this.adapter.requestDevice(),i(this.device),this.context=this.canvas.getContext("webgpu"),i(this.context),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})})),this.createAssets=()=>m(this,void 0,void 0,(function*(){this.mesh=new r(this.device),this.material=new c,yield this.material.initialize(this.device,"dist/img/sacabambaspis.png"),this.shader=new o(this.device)})),this.makePipeline=()=>m(this,void 0,void 0,(function*(){this.uniformBuffer=this.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]});this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]}),i(this.bindGroup);const e=this.device.createPipelineLayout({bindGroupLayouts:[t]});this.pipeline=this.device.createRenderPipeline({vertex:{module:this.shader.module,entryPoint:this.shader.entryPoint.Vertex,buffers:[this.shader.bufferLayout]},fragment:{module:this.shader.module,entryPoint:this.shader.entryPoint.Fragment,targets:[{format:this.format}]},primitive:{topology:"triangle-list"},layout:e}),i(this.pipeline)})),this.render=()=>{const t=h();!function(t,e,i,n,r){var s,o=1/Math.tan(e/2);t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(s=1/(n-r),t[10]=(r+n)*s,t[14]=2*r*n*s):(t[10]=-1,t[14]=-2*n)}(t,Math.PI/4,this.canvas.width/this.canvas.height,.1,10);const e=h();var i,n,r,s,o,u,f,c,l,d,m,v,p,x,g,y,B,b,P,w,_,M,U;i=e,g=(n=[0,1,-2])[0],y=n[1],B=n[2],b=(s=[0,1,0])[0],P=s[1],w=s[2],_=(r=[0,0,0])[0],M=r[1],U=r[2],Math.abs(g-_)<a&&Math.abs(y-M)<a&&Math.abs(B-U)<a?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(i):(m=g-_,v=y-M,p=B-U,o=P*(p*=x=1/Math.hypot(m,v,p))-w*(v*=x),u=w*(m*=x)-b*p,f=b*v-P*m,(x=Math.hypot(o,u,f))?(o*=x=1/x,u*=x,f*=x):(o=0,u=0,f=0),c=v*f-p*u,l=p*o-m*f,d=m*u-v*o,(x=Math.hypot(c,l,d))?(c*=x=1/x,l*=x,d*=x):(c=0,l=0,d=0),i[0]=o,i[1]=c,i[2]=m,i[3]=0,i[4]=u,i[5]=l,i[6]=v,i[7]=0,i[8]=f,i[9]=d,i[10]=p,i[11]=0,i[12]=-(o*g+u*y+f*B),i[13]=-(c*g+l*y+d*B),i[14]=-(m*g+v*y+p*B),i[15]=1);const C=h();!function(t,e,i){var n,r,s,o,a,u,h,f,c,l,d,m,v=i[0],p=i[1],x=i[2];e===t?(t[12]=e[0]*v+e[4]*p+e[8]*x+e[12],t[13]=e[1]*v+e[5]*p+e[9]*x+e[13],t[14]=e[2]*v+e[6]*p+e[10]*x+e[14],t[15]=e[3]*v+e[7]*p+e[11]*x+e[15]):(n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],f=e[7],c=e[8],l=e[9],d=e[10],m=e[11],t[0]=n,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=h,t[7]=f,t[8]=c,t[9]=l,t[10]=d,t[11]=m,t[12]=n*v+a*p+c*x+e[12],t[13]=r*v+u*p+l*x+e[13],t[14]=s*v+h*p+d*x+e[14],t[15]=o*v+f*p+m*x+e[15])}(C,C,[Math.sin(this.time),0,0]),function(t,e,i,n){var r,s,o,u,h,f,c,l,d,m,v,p,x,g,y,B,b,P,w,_,M,U,C,T,G=n[0],A=n[1],I=n[2],E=Math.hypot(G,A,I);E<a||(G*=E=1/E,A*=E,I*=E,r=Math.sin(i),o=1-(s=Math.cos(i)),u=e[0],h=e[1],f=e[2],c=e[3],l=e[4],d=e[5],m=e[6],v=e[7],p=e[8],x=e[9],g=e[10],y=e[11],B=G*G*o+s,b=A*G*o+I*r,P=I*G*o-A*r,w=G*A*o-I*r,_=A*A*o+s,M=I*A*o+G*r,U=G*I*o+A*r,C=A*I*o-G*r,T=I*I*o+s,t[0]=u*B+l*b+p*P,t[1]=h*B+d*b+x*P,t[2]=f*B+m*b+g*P,t[3]=c*B+v*b+y*P,t[4]=u*w+l*_+p*M,t[5]=h*w+d*_+x*M,t[6]=f*w+m*_+g*M,t[7]=c*w+v*_+y*M,t[8]=u*U+l*C+p*T,t[9]=h*U+d*C+x*T,t[10]=f*U+m*C+g*T,t[11]=c*U+v*C+y*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(C,C,this.time,[0,1,0]),this.device.queue.writeBuffer(this.uniformBuffer,0,C),this.device.queue.writeBuffer(this.uniformBuffer,64,e),this.device.queue.writeBuffer(this.uniformBuffer,128,t);const T=this.device.createCommandEncoder(),G={colorAttachments:[{view:this.context.getCurrentTexture().createView(),clearValue:[.5,0,.25,1],loadOp:"clear",storeOp:"store"}]},A=T.beginRenderPass(G);A.setPipeline(this.pipeline),A.setBindGroup(0,this.bindGroup),A.setVertexBuffer(0,this.mesh.vertexBuffer),A.setIndexBuffer(this.mesh.indexBuffer,this.mesh.indexFormat),A.drawIndexed(this.mesh.indexCount),A.end(),this.device.queue.submit([T.finish()]),this.time+=.01,this.time>2*Math.PI&&(this.time-=2*Math.PI),requestAnimationFrame(this.render)},this.canvas=t,this.adapter=null,this.device=null,this.context=null,this.format=null,this.uniformBuffer=null,this.bindGroup=null,this.pipeline=null,this.mesh=null,this.material=null,this.shader=null,this.time=0}}d=function*(){const t=document.getElementById("gfx-main");new v(t).Initialize()},new((l=void 0)||(l=Promise))((function(t,e){function i(t){try{r(d.next(t))}catch(t){e(t)}}function n(t){try{r(d.throw(t))}catch(t){e(t)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof l?r:new l((function(t){t(r)}))).then(i,n)}r((d=d.apply(void 0,[])).next())}))})();