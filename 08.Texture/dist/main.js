(()=>{"use strict";class t{constructor(t,e){const i=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,r={size:e.byteLength,usage:i,mappedAtCreation:!0};this.buffer=t.createBuffer(r),new Uint32Array(this.buffer.getMappedRange()).set(e),this.buffer.unmap()}}class e{constructor(t,e){const i=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,r={size:e.byteLength,usage:i,mappedAtCreation:!0};this.buffer=t.createBuffer(r),new Float32Array(this.buffer.getMappedRange()).set(e),this.buffer.unmap()}}const i=t=>{if(null===t)throw Error(t+"is null");console.log("success")};class r{constructor(){this._vertexBuffer=null,this._indexBuffer=null,this._indexCount=null,this._indexFormat="uint32"}get vertexBuffer(){return i(this._vertexBuffer),this._vertexBuffer.buffer}get indexBuffer(){return i(this._indexBuffer),this._indexBuffer.buffer}get indexCount(){return i(this._indexCount),this._indexCount}get indexFormat(){return this._indexFormat}}class n extends r{constructor(i){super();const r=new Float32Array([-.5,.5,0,1,0,0,-.5,-.5,0,0,1,0,.5,.5,0,0,0,1,.5,-.5,0,1,0,0]);this._vertexBuffer=new e(i,r);const n=new Uint32Array([0,1,2,2,1,3]);this._indexCount=n.length,this._indexBuffer=new t(i,n)}}class s{constructor(){this._module=null,this._bufferLayout=null,this._entryPoint={Vertex:"vs_main",Fragment:"fs_main"}}get module(){return i(this._module),this._module}get bufferLayout(){return i(this._bufferLayout),this._bufferLayout}get entryPoint(){return this._entryPoint}}class o extends s{constructor(t){super(),this._module=t.createShaderModule({code:"struct TransformData{\r\n  model: mat4x4<f32>,\r\n  view: mat4x4<f32>,\r\n  projection: mat4x4<f32>\r\n};\r\n@binding(0) @group(0) var <uniform> transformUBO : TransformData;\r\n\r\nstruct Output {\r\n    @builtin(position) Position : vec4<f32>,\r\n    @location(0) Color : vec4<f32>\r\n};\r\n\r\n@vertex\r\nfn vs_main(@location(0) vertexPosition: vec3<f32>, @location(1) vertexColor: vec3<f32> ) -> Output {\r\n\r\n\r\n\r\n    var output : Output;\r\n    var mvpMat = transformUBO.projection * transformUBO.view * transformUBO.model;\r\n    output.Position = mvpMat * vec4<f32>(vertexPosition, 1.0);\r\n    output.Color = vec4<f32>(vertexColor, 1.0);\r\n\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fs_main(@location(0) Color: vec4<f32>) -> @location(0) vec4<f32> {\r\n    return Color;\r\n}"}),this._bufferLayout={arrayStride:24,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12}]}}}var a=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array;function f(){var t=new u(16);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var h,c,d=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))};class l{constructor(t){this.Initialize=()=>d(this,void 0,void 0,(function*(){yield this.setupDevice(),this.createAssets(),yield this.makePipeline(),this.render()})),this.setupDevice=()=>d(this,void 0,void 0,(function*(){var t;this.adapter=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter(),i(this.adapter),this.device=yield this.adapter.requestDevice(),i(this.device),this.context=this.canvas.getContext("webgpu"),i(this.context),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})})),this.createAssets=()=>{this.mesh=new n(this.device),this.shader=new o(this.device)},this.makePipeline=()=>d(this,void 0,void 0,(function*(){this.uniformBuffer=this.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]});this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]}),i(this.bindGroup);const e=this.device.createPipelineLayout({bindGroupLayouts:[t]});this.pipeline=this.device.createRenderPipeline({vertex:{module:this.shader.module,entryPoint:this.shader.entryPoint.Vertex,buffers:[this.shader.bufferLayout]},fragment:{module:this.shader.module,entryPoint:this.shader.entryPoint.Fragment,targets:[{format:this.format}]},primitive:{topology:"triangle-list"},layout:e}),i(this.pipeline)})),this.render=()=>{const t=f();!function(t,e,i,r,n){var s,o=1/Math.tan(e/2);t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(s=1/(r-n),t[10]=(n+r)*s,t[14]=2*n*r*s):(t[10]=-1,t[14]=-2*r)}(t,Math.PI/4,this.canvas.width/this.canvas.height,.1,10);const e=f();var i,r,n,s,o,u,h,c,d,l,v,m,p,x,y,g,B,b,P,_,w,M,C;i=e,y=(r=[0,1,-2])[0],g=r[1],B=r[2],b=(s=[0,1,0])[0],P=s[1],_=s[2],w=(n=[0,0,0])[0],M=n[1],C=n[2],Math.abs(y-w)<a&&Math.abs(g-M)<a&&Math.abs(B-C)<a?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(i):(v=y-w,m=g-M,p=B-C,o=P*(p*=x=1/Math.hypot(v,m,p))-_*(m*=x),u=_*(v*=x)-b*p,h=b*m-P*v,(x=Math.hypot(o,u,h))?(o*=x=1/x,u*=x,h*=x):(o=0,u=0,h=0),c=m*h-p*u,d=p*o-v*h,l=v*u-m*o,(x=Math.hypot(c,d,l))?(c*=x=1/x,d*=x,l*=x):(c=0,d=0,l=0),i[0]=o,i[1]=c,i[2]=v,i[3]=0,i[4]=u,i[5]=d,i[6]=m,i[7]=0,i[8]=h,i[9]=l,i[10]=p,i[11]=0,i[12]=-(o*y+u*g+h*B),i[13]=-(c*y+d*g+l*B),i[14]=-(v*y+m*g+p*B),i[15]=1);const U=f();!function(t,e,i){var r,n,s,o,a,u,f,h,c,d,l,v,m=i[0],p=i[1],x=i[2];e===t?(t[12]=e[0]*m+e[4]*p+e[8]*x+e[12],t[13]=e[1]*m+e[5]*p+e[9]*x+e[13],t[14]=e[2]*m+e[6]*p+e[10]*x+e[14],t[15]=e[3]*m+e[7]*p+e[11]*x+e[15]):(r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],f=e[6],h=e[7],c=e[8],d=e[9],l=e[10],v=e[11],t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=f,t[7]=h,t[8]=c,t[9]=d,t[10]=l,t[11]=v,t[12]=r*m+a*p+c*x+e[12],t[13]=n*m+u*p+d*x+e[13],t[14]=s*m+f*p+l*x+e[14],t[15]=o*m+h*p+v*x+e[15])}(U,U,[Math.sin(this.time),0,0]),function(t,e,i,r){var n,s,o,u,f,h,c,d,l,v,m,p,x,y,g,B,b,P,_,w,M,C,U,A,G=r[0],F=r[1],L=r[2],O=Math.hypot(G,F,L);O<a||(G*=O=1/O,F*=O,L*=O,n=Math.sin(i),o=1-(s=Math.cos(i)),u=e[0],f=e[1],h=e[2],c=e[3],d=e[4],l=e[5],v=e[6],m=e[7],p=e[8],x=e[9],y=e[10],g=e[11],B=G*G*o+s,b=F*G*o+L*n,P=L*G*o-F*n,_=G*F*o-L*n,w=F*F*o+s,M=L*F*o+G*n,C=G*L*o+F*n,U=F*L*o-G*n,A=L*L*o+s,t[0]=u*B+d*b+p*P,t[1]=f*B+l*b+x*P,t[2]=h*B+v*b+y*P,t[3]=c*B+m*b+g*P,t[4]=u*_+d*w+p*M,t[5]=f*_+l*w+x*M,t[6]=h*_+v*w+y*M,t[7]=c*_+m*w+g*M,t[8]=u*C+d*U+p*A,t[9]=f*C+l*U+x*A,t[10]=h*C+v*U+y*A,t[11]=c*C+m*U+g*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(U,U,this.time,[0,1,0]),this.device.queue.writeBuffer(this.uniformBuffer,0,U),this.device.queue.writeBuffer(this.uniformBuffer,64,e),this.device.queue.writeBuffer(this.uniformBuffer,128,t);const A=this.device.createCommandEncoder(),G={colorAttachments:[{view:this.context.getCurrentTexture().createView(),clearValue:[.5,0,.25,1],loadOp:"clear",storeOp:"store"}]},F=A.beginRenderPass(G);F.setPipeline(this.pipeline),F.setBindGroup(0,this.bindGroup),F.setVertexBuffer(0,this.mesh.vertexBuffer),F.setIndexBuffer(this.mesh.indexBuffer,this.mesh.indexFormat),F.drawIndexed(this.mesh.indexCount),F.end(),this.device.queue.submit([A.finish()]),this.time+=.01,this.time>2*Math.PI&&(this.time-=2*Math.PI),requestAnimationFrame(this.render)},this.canvas=t,this.adapter=null,this.device=null,this.context=null,this.format=null,this.uniformBuffer=null,this.bindGroup=null,this.pipeline=null,this.mesh=null,this.shader=null,this.time=0}}c=function*(){const t=document.getElementById("gfx-main");new l(t).Initialize()},new((h=void 0)||(h=Promise))((function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){var n;e.done?t(e.value):(n=e.value,n instanceof h?n:new h((function(t){t(n)}))).then(i,r)}n((c=c.apply(void 0,[])).next())}))})();